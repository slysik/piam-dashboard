<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClearView Intelligence - Data Flow Architecture</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        header {
            text-align: center;
            margin-bottom: 60px;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #a0aec0;
            font-size: 1.1rem;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 24px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .nav-tab:hover, .nav-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: transparent;
        }

        /* Slide Container */
        .slide {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .slide.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Architecture Diagram */
        .architecture {
            display: flex;
            flex-direction: column;
            gap: 30px;
            align-items: center;
        }

        .layer {
            width: 100%;
            max-width: 1000px;
            padding: 30px;
            border-radius: 16px;
            position: relative;
        }

        .layer-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #a0aec0;
            margin-bottom: 20px;
        }

        /* Frontend Layer */
        .frontend-layer {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            border: 1px solid rgba(102, 126, 234, 0.3);
        }

        .components-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .component {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .component:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-5px);
        }

        .component-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .component-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .component-desc {
            font-size: 0.8rem;
            color: #a0aec0;
        }

        /* Arrow */
        .arrow {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #667eea;
        }

        .arrow-line {
            width: 4px;
            height: 40px;
            background: linear-gradient(180deg, #667eea, #764ba2);
            border-radius: 2px;
        }

        .arrow-head {
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-top: 15px solid #764ba2;
        }

        .arrow-label {
            font-size: 0.75rem;
            color: #a0aec0;
            margin-top: 5px;
        }

        .arrow-up .arrow-head {
            border-top: none;
            border-bottom: 15px solid #667eea;
        }

        /* API Layer */
        .api-layer {
            background: linear-gradient(135deg, rgba(246, 173, 85, 0.2), rgba(240, 147, 251, 0.2));
            border: 1px solid rgba(246, 173, 85, 0.3);
        }

        /* Hooks Layer */
        .hooks-layer {
            background: linear-gradient(135deg, rgba(72, 187, 120, 0.2), rgba(56, 178, 172, 0.2));
            border: 1px solid rgba(72, 187, 120, 0.3);
        }

        /* Database Layer */
        .database-layer {
            background: linear-gradient(135deg, rgba(237, 100, 166, 0.2), rgba(245, 101, 101, 0.2));
            border: 1px solid rgba(237, 100, 166, 0.3);
        }

        /* PACS Layer */
        .pacs-layer {
            background: linear-gradient(135deg, rgba(99, 179, 237, 0.2), rgba(66, 153, 225, 0.2));
            border: 1px solid rgba(99, 179, 237, 0.3);
        }

        /* Code Block */
        .code-block {
            background: #0d1117;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
            font-family: 'Fira Code', 'Monaco', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
        }

        .code-block .keyword { color: #ff7b72; }
        .code-block .string { color: #a5d6ff; }
        .code-block .function { color: #d2a8ff; }
        .code-block .comment { color: #8b949e; }
        .code-block .variable { color: #ffa657; }

        /* Flow Diagram */
        .flow-diagram {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
            padding: 20px;
        }

        .flow-box {
            flex: 1;
            min-width: 150px;
            max-width: 200px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            text-align: center;
        }

        .flow-arrow {
            font-size: 2rem;
            color: #667eea;
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .data-table th, .data-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .data-table th {
            background: rgba(102, 126, 234, 0.3);
            font-weight: 600;
        }

        .data-table tr:hover {
            background: rgba(255,255,255,0.05);
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-green { background: rgba(72, 187, 120, 0.3); color: #68d391; }
        .badge-blue { background: rgba(99, 179, 237, 0.3); color: #63b3ed; }
        .badge-orange { background: rgba(246, 173, 85, 0.3); color: #f6ad55; }
        .badge-purple { background: rgba(159, 122, 234, 0.3); color: #b794f4; }

        /* Sequence Diagram */
        .sequence {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 20px;
        }

        .sequence-step {
            display: flex;
            align-items: flex-start;
            gap: 20px;
        }

        .step-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
            background: rgba(255,255,255,0.05);
            padding: 15px 20px;
            border-radius: 12px;
            border-left: 3px solid #667eea;
        }

        .step-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .step-desc {
            font-size: 0.9rem;
            color: #a0aec0;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 40px;
            color: #a0aec0;
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 { font-size: 1.8rem; }
            .layer { padding: 20px; }
            .flow-diagram { flex-direction: column; }
            .flow-arrow { transform: rotate(90deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ClearView Intelligence</h1>
            <p class="subtitle">Data Flow Architecture - From ClickHouse to React Frontend</p>
        </header>

        <nav class="nav-tabs">
            <div class="nav-tab active" onclick="showSlide(0)">Overview</div>
            <div class="nav-tab" onclick="showSlide(1)">Data Layer</div>
            <div class="nav-tab" onclick="showSlide(2)">API Layer</div>
            <div class="nav-tab" onclick="showSlide(3)">Hooks Layer</div>
            <div class="nav-tab" onclick="showSlide(4)">Components</div>
            <div class="nav-tab" onclick="showSlide(5)">Data Flow</div>
        </nav>

        <!-- Slide 0: Overview -->
        <div class="slide active" id="slide-0">
            <div class="architecture">
                <!-- Frontend Layer -->
                <div class="layer frontend-layer">
                    <div class="layer-title">Frontend Layer - React Components</div>
                    <div class="components-grid">
                        <div class="component">
                            <div class="component-icon">üìä</div>
                            <div class="component-name">Executive Overview</div>
                            <div class="component-desc">KPIs, Risk Trends, Compliance</div>
                        </div>
                        <div class="component">
                            <div class="component-icon">üî¥</div>
                            <div class="component-name">Real-Time Risk</div>
                            <div class="component-desc">Live Events, Anomalies, Video</div>
                        </div>
                        <div class="component">
                            <div class="component-icon">‚úÖ</div>
                            <div class="component-name">Compliance & Audit</div>
                            <div class="component-desc">Certifications, Expiry Tracking</div>
                        </div>
                        <div class="component">
                            <div class="component-icon">ü§ñ</div>
                            <div class="component-name">Dashboard Builder</div>
                            <div class="component-desc">AI-Generated Visualizations</div>
                        </div>
                    </div>
                </div>

                <div class="arrow">
                    <div class="arrow-line"></div>
                    <div class="arrow-head"></div>
                    <div class="arrow-label">Props & State</div>
                </div>

                <!-- Hooks Layer -->
                <div class="layer hooks-layer">
                    <div class="layer-title">Custom Hooks - Data Fetching & State Management</div>
                    <div class="components-grid">
                        <div class="component">
                            <div class="component-icon">üîÑ</div>
                            <div class="component-name">useClickHouse</div>
                            <div class="component-desc">Auto-refresh queries with fallback</div>
                        </div>
                        <div class="component">
                            <div class="component-icon">üìà</div>
                            <div class="component-name">useDashboardData</div>
                            <div class="component-desc">Aggregated dashboard state</div>
                        </div>
                        <div class="component">
                            <div class="component-icon">üåê</div>
                            <div class="component-name">DataContext</div>
                            <div class="component-desc">Tenant & Persona selection</div>
                        </div>
                    </div>
                </div>

                <div class="arrow">
                    <div class="arrow-line"></div>
                    <div class="arrow-head"></div>
                    <div class="arrow-label">HTTP POST (JSON)</div>
                </div>

                <!-- API Layer -->
                <div class="layer api-layer">
                    <div class="layer-title">API Routes - Next.js Server</div>
                    <div class="components-grid">
                        <div class="component">
                            <div class="component-icon">üîå</div>
                            <div class="component-name">/api/clickhouse</div>
                            <div class="component-desc">Query proxy with auth</div>
                        </div>
                        <div class="component">
                            <div class="component-icon">üíß</div>
                            <div class="component-name">/api/trickle</div>
                            <div class="component-desc">Live event generation</div>
                        </div>
                        <div class="component">
                            <div class="component-icon">üé®</div>
                            <div class="component-name">/api/generate-dashboard</div>
                            <div class="component-desc">AI visualization builder</div>
                        </div>
                    </div>
                </div>

                <div class="arrow">
                    <div class="arrow-line"></div>
                    <div class="arrow-head"></div>
                    <div class="arrow-label">HTTP/SQL over port 8123</div>
                </div>

                <!-- Database Layer -->
                <div class="layer database-layer">
                    <div class="layer-title">Database Layer - ClickHouse OLAP</div>
                    <div class="components-grid">
                        <div class="component">
                            <div class="component-icon">üìã</div>
                            <div class="component-name">access_events</div>
                            <div class="component-desc">Core fact table (partitioned)</div>
                        </div>
                        <div class="component">
                            <div class="component-icon">üëÅÔ∏è</div>
                            <div class="component-name">Views (v_*)</div>
                            <div class="component-desc">Pre-aggregated queries</div>
                        </div>
                        <div class="component">
                            <div class="component-icon">üë§</div>
                            <div class="component-name">persons</div>
                            <div class="component-desc">Identity dimension</div>
                        </div>
                        <div class="component">
                            <div class="component-icon">üîó</div>
                            <div class="component-name">connector_health</div>
                            <div class="component-desc">PACS system status</div>
                        </div>
                    </div>
                </div>

                <div class="arrow arrow-up">
                    <div class="arrow-head"></div>
                    <div class="arrow-line"></div>
                    <div class="arrow-label">Event Ingestion</div>
                </div>

                <!-- PACS Layer -->
                <div class="layer pacs-layer">
                    <div class="layer-title">Physical Access Control Systems</div>
                    <div class="components-grid">
                        <div class="component">
                            <div class="component-icon">üè¢</div>
                            <div class="component-name">Lenel</div>
                            <div class="component-desc">OnGuard integration</div>
                        </div>
                        <div class="component">
                            <div class="component-icon">üîê</div>
                            <div class="component-name">C-CURE</div>
                            <div class="component-desc">9000 series</div>
                        </div>
                        <div class="component">
                            <div class="component-icon">üö™</div>
                            <div class="component-name">S2</div>
                            <div class="component-desc">NetBox connector</div>
                        </div>
                        <div class="component">
                            <div class="component-icon">üìπ</div>
                            <div class="component-name">Genetec</div>
                            <div class="component-desc">Security Center</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 1: Data Layer -->
        <div class="slide" id="slide-1">
            <h2 style="text-align: center; margin-bottom: 30px;">ClickHouse Data Model</h2>

            <div class="layer database-layer" style="max-width: 1000px; margin: 0 auto;">
                <div class="layer-title">Core Tables & Views</div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Table/View</th>
                            <th>Type</th>
                            <th>Purpose</th>
                            <th>Refresh</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>access_events</code></td>
                            <td><span class="badge badge-purple">Fact</span></td>
                            <td>All badge swipe events from PACS</td>
                            <td><span class="badge badge-green">Real-time</span></td>
                        </tr>
                        <tr>
                            <td><code>v_kpi_current</code></td>
                            <td><span class="badge badge-blue">View</span></td>
                            <td>Dashboard KPIs (15m/24h windows)</td>
                            <td><span class="badge badge-orange">15s</span></td>
                        </tr>
                        <tr>
                            <td><code>v_timeseries_minute</code></td>
                            <td><span class="badge badge-blue">View</span></td>
                            <td>Per-minute aggregates for charts</td>
                            <td><span class="badge badge-orange">15s</span></td>
                        </tr>
                        <tr>
                            <td><code>v_recent_events</code></td>
                            <td><span class="badge badge-blue">View</span></td>
                            <td>Last hour events with details</td>
                            <td><span class="badge badge-green">5s</span></td>
                        </tr>
                        <tr>
                            <td><code>v_door_hotspots</code></td>
                            <td><span class="badge badge-blue">View</span></td>
                            <td>Deny rate by location for map</td>
                            <td><span class="badge badge-orange">30s</span></td>
                        </tr>
                        <tr>
                            <td><code>v_connector_health_latest</code></td>
                            <td><span class="badge badge-blue">View</span></td>
                            <td>PACS connector status</td>
                            <td><span class="badge badge-orange">10s</span></td>
                        </tr>
                        <tr>
                            <td><code>v_insight_deny_spikes</code></td>
                            <td><span class="badge badge-blue">View</span></td>
                            <td>Anomaly detection (deny spikes)</td>
                            <td><span class="badge badge-orange">30s</span></td>
                        </tr>
                        <tr>
                            <td><code>persons</code></td>
                            <td><span class="badge badge-purple">Dimension</span></td>
                            <td>Identity data from HR/PIAM</td>
                            <td><span class="badge badge-blue">Batch</span></td>
                        </tr>
                    </tbody>
                </table>

                <div class="code-block">
<span class="comment">-- Example: v_kpi_current view structure</span>
<span class="keyword">SELECT</span>
    tenant_id,
    <span class="function">countIf</span>(event_time >= <span class="function">now</span>() - <span class="keyword">INTERVAL</span> <span class="string">15 MINUTE</span>) <span class="keyword">AS</span> <span class="variable">events_15m</span>,
    <span class="function">countIf</span>(event_time >= <span class="function">now</span>() - <span class="keyword">INTERVAL</span> <span class="string">15 MINUTE</span> <span class="keyword">AND</span> result = <span class="string">'deny'</span>) <span class="keyword">AS</span> <span class="variable">denies_15m</span>,
    <span class="function">round</span>(<span class="keyword">if</span>(events_15m > 0, denies_15m * 100.0 / events_15m, 0), 1) <span class="keyword">AS</span> <span class="variable">deny_rate_15m</span>,
    <span class="function">countIf</span>(suspicious_flag = 1) <span class="keyword">AS</span> <span class="variable">suspicious_15m</span>
<span class="keyword">FROM</span> piam.access_events
<span class="keyword">WHERE</span> event_time >= <span class="function">now</span>() - <span class="keyword">INTERVAL</span> <span class="string">24 HOUR</span>
<span class="keyword">GROUP BY</span> tenant_id;
                </div>
            </div>
        </div>

        <!-- Slide 2: API Layer -->
        <div class="slide" id="slide-2">
            <h2 style="text-align: center; margin-bottom: 30px;">API Routes</h2>

            <div class="layer api-layer" style="max-width: 1000px; margin: 0 auto;">
                <div class="layer-title">/api/clickhouse - Query Proxy</div>

                <div class="flow-diagram">
                    <div class="flow-box">
                        <div style="font-size: 2rem;">üñ•Ô∏è</div>
                        <div style="font-weight: 600;">Frontend</div>
                        <div style="font-size: 0.8rem; color: #a0aec0;">POST request</div>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-box">
                        <div style="font-size: 2rem;">‚öôÔ∏è</div>
                        <div style="font-weight: 600;">API Route</div>
                        <div style="font-size: 0.8rem; color: #a0aec0;">Auth + Transform</div>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-box">
                        <div style="font-size: 2rem;">üóÑÔ∏è</div>
                        <div style="font-weight: 600;">ClickHouse</div>
                        <div style="font-size: 0.8rem; color: #a0aec0;">:8123 HTTP</div>
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-box">
                        <div style="font-size: 2rem;">üìä</div>
                        <div style="font-weight: 600;">JSON Response</div>
                        <div style="font-size: 0.8rem; color: #a0aec0;">Formatted data</div>
                    </div>
                </div>

                <div class="code-block">
<span class="comment">// /api/clickhouse/route.ts</span>
<span class="keyword">export async function</span> <span class="function">POST</span>(request: NextRequest) {
  <span class="keyword">const</span> { query, params } = <span class="keyword">await</span> request.<span class="function">json</span>();

  <span class="comment">// Build ClickHouse URL with auth</span>
  <span class="keyword">const</span> url = <span class="keyword">new</span> <span class="function">URL</span>(clickhouseUrl);
  url.searchParams.<span class="function">set</span>(<span class="string">'database'</span>, <span class="string">'piam'</span>);
  url.searchParams.<span class="function">set</span>(<span class="string">'user'</span>, username);
  url.searchParams.<span class="function">set</span>(<span class="string">'password'</span>, password);

  <span class="comment">// Execute query</span>
  <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(url, {
    method: <span class="string">'POST'</span>,
    body: query + <span class="string">' FORMAT JSON'</span>
  });

  <span class="keyword">return</span> NextResponse.<span class="function">json</span>(data);
}
                </div>
            </div>

            <div class="layer api-layer" style="max-width: 1000px; margin: 30px auto 0;">
                <div class="layer-title">/api/trickle - Live Event Generator</div>

                <div class="code-block">
<span class="comment">// Generates synthetic access events for demo</span>
<span class="keyword">const</span> events = [];
<span class="keyword">for</span> (<span class="keyword">let</span> i = 0; i < numEvents; i++) {
  events.<span class="function">push</span>({
    tenant_id: tenant,
    person_name: <span class="variable">randomPerson</span>,
    location_name: <span class="variable">randomDoor</span>,
    result: Math.<span class="function">random</span>() > 0.15 ? <span class="string">'grant'</span> : <span class="string">'deny'</span>,
    video_clip_url: <span class="variable">sampleVideos</span>[<span class="function">randomIndex</span>],
    risk_score: Math.<span class="function">floor</span>(Math.<span class="function">random</span>() * 100)
  });
}

<span class="comment">// INSERT into ClickHouse</span>
<span class="keyword">await</span> <span class="function">fetch</span>(clickhouseUrl, { body: insertQuery });
                </div>
            </div>
        </div>

        <!-- Slide 3: Hooks Layer -->
        <div class="slide" id="slide-3">
            <h2 style="text-align: center; margin-bottom: 30px;">Custom Hooks</h2>

            <div class="layer hooks-layer" style="max-width: 1000px; margin: 0 auto;">
                <div class="layer-title">useClickHouse Hook - Auto-Refresh with Fallback</div>

                <div class="code-block">
<span class="comment">// hooks/useClickHouse.ts</span>
<span class="keyword">export function</span> <span class="function">useClickHouse</span>&lt;T&gt;({
  query,
  params,
  refreshInterval = 15000,
  fallbackData,
  enabled = true
}: UseClickHouseOptions&lt;T&gt;) {

  <span class="keyword">const</span> [data, setData] = <span class="function">useState</span>&lt;T | null&gt;(fallbackData);
  <span class="keyword">const</span> [loading, setLoading] = <span class="function">useState</span>(true);
  <span class="keyword">const</span> [error, setError] = <span class="function">useState</span>&lt;Error | null&gt;(null);

  <span class="function">useEffect</span>(() => {
    <span class="keyword">const</span> fetchData = <span class="keyword">async</span> () => {
      <span class="keyword">try</span> {
        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="string">'/api/clickhouse'</span>, {
          method: <span class="string">'POST'</span>,
          body: JSON.<span class="function">stringify</span>({ query, params })
        });
        <span class="keyword">const</span> result = <span class="keyword">await</span> response.<span class="function">json</span>();
        <span class="function">setData</span>(result.data);
      } <span class="keyword">catch</span> (err) {
        <span class="function">setError</span>(err);
        <span class="function">setData</span>(fallbackData); <span class="comment">// Graceful degradation</span>
      }
    };

    fetchData();
    <span class="keyword">const</span> interval = <span class="function">setInterval</span>(fetchData, refreshInterval);
    <span class="keyword">return</span> () => <span class="function">clearInterval</span>(interval);
  }, [query, refreshInterval]);

  <span class="keyword">return</span> { data, loading, error, refetch };
}
                </div>

                <div style="margin-top: 30px;">
                    <div class="layer-title">Usage in Components</div>
                    <div class="code-block">
<span class="comment">// In a dashboard component</span>
<span class="keyword">const</span> { data: kpis } = <span class="function">useClickHouse</span>({
  query: <span class="string">`SELECT * FROM piam.v_kpi_current
          WHERE tenant_id = {tenant:String}`</span>,
  params: { tenant: <span class="string">'acme-corp'</span> },
  refreshInterval: 15000,
  fallbackData: { events_15m: 0, denies_15m: 0 }
});
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 4: Components -->
        <div class="slide" id="slide-4">
            <h2 style="text-align: center; margin-bottom: 30px;">React Components</h2>

            <div class="layer frontend-layer" style="max-width: 1000px; margin: 0 auto;">
                <div class="layer-title">Component Architecture</div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Component</th>
                            <th>Data Source</th>
                            <th>Refresh Rate</th>
                            <th>Features</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>KPICards.tsx</code></td>
                            <td>v_kpi_current</td>
                            <td>15s</td>
                            <td>Overall risk, compliance rate, incidents</td>
                        </tr>
                        <tr>
                            <td><code>RiskTrendChart.tsx</code></td>
                            <td>v_timeseries_minute</td>
                            <td>15s</td>
                            <td>7-day trend with Recharts</td>
                        </tr>
                        <tr>
                            <td><code>DoorHotspotsMap.tsx</code></td>
                            <td>v_door_hotspots</td>
                            <td>30s</td>
                            <td>Mapbox GL markers + clustering</td>
                        </tr>
                        <tr>
                            <td><code>RealTimeRiskPanel.tsx</code></td>
                            <td>v_recent_events</td>
                            <td>5s</td>
                            <td>Live stream, anomalies, video evidence</td>
                        </tr>
                        <tr>
                            <td><code>ConnectorHealth.tsx</code></td>
                            <td>v_connector_health_latest</td>
                            <td>10s</td>
                            <td>PACS system status indicators</td>
                        </tr>
                        <tr>
                            <td><code>ComplianceOverview.tsx</code></td>
                            <td>v_compliance_summary</td>
                            <td>60s</td>
                            <td>Training expiry, certifications</td>
                        </tr>
                    </tbody>
                </table>

                <div class="code-block">
<span class="comment">// Example: RealTimeRiskPanel.tsx</span>
<span class="keyword">export default function</span> <span class="function">RealTimeRiskPanel</span>({ tenant }) {
  <span class="keyword">const</span> { data: events } = <span class="function">useClickHouse</span>({
    query: <span class="string">`SELECT * FROM piam.v_recent_events
            WHERE tenant_id = {tenant:String}
            ORDER BY event_time DESC LIMIT 50`</span>,
    params: { tenant },
    refreshInterval: 5000
  });

  <span class="keyword">return</span> (
    &lt;<span class="variable">div</span>&gt;
      {events?.<span class="function">map</span>(event =&gt; (
        &lt;<span class="variable">EventRow</span>
          key={event.event_id}
          person={event.person_name}
          result={event.result}
          videoUrl={event.video_clip_url}
        /&gt;
      ))}
    &lt;/<span class="variable">div</span>&gt;
  );
}
                </div>
            </div>
        </div>

        <!-- Slide 5: Data Flow -->
        <div class="slide" id="slide-5">
            <h2 style="text-align: center; margin-bottom: 30px;">Complete Data Flow Sequence</h2>

            <div class="layer" style="background: rgba(255,255,255,0.05); max-width: 1000px; margin: 0 auto;">
                <div class="sequence">
                    <div class="sequence-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <div class="step-title">PACS Event Generated</div>
                            <div class="step-desc">Employee badges at Server Room D1 via Lenel system. Event includes: badge_id, door_id, timestamp, result (grant/deny)</div>
                        </div>
                    </div>

                    <div class="sequence-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <div class="step-title">Connector Ingests Event</div>
                            <div class="step-desc">Lenel connector transforms raw event to unified schema, adds tenant_id, enriches with person_name from HR sync</div>
                        </div>
                    </div>

                    <div class="sequence-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <div class="step-title">ClickHouse INSERT</div>
                            <div class="step-desc">Event written to piam.access_events table. Partitioned by month, indexed on tenant_id + event_time</div>
                        </div>
                    </div>

                    <div class="sequence-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <div class="step-title">Views Auto-Update</div>
                            <div class="step-desc">v_kpi_current, v_recent_events, v_door_hotspots recalculate on query (no materialization needed for sub-second perf)</div>
                        </div>
                    </div>

                    <div class="sequence-step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <div class="step-title">useClickHouse Polls</div>
                            <div class="step-desc">Frontend hook fetches /api/clickhouse every 5-15s depending on view. Sends parameterized query with tenant filter</div>
                        </div>
                    </div>

                    <div class="sequence-step">
                        <div class="step-number">6</div>
                        <div class="step-content">
                            <div class="step-title">API Route Proxies</div>
                            <div class="step-desc">Next.js server adds credentials, forwards to ClickHouse HTTP interface, transforms response to JSON</div>
                        </div>
                    </div>

                    <div class="sequence-step">
                        <div class="step-number">7</div>
                        <div class="step-content">
                            <div class="step-title">React State Updates</div>
                            <div class="step-desc">Hook updates component state, React re-renders with new data. User sees event appear in Live Event Stream within 5 seconds</div>
                        </div>
                    </div>

                    <div class="sequence-step">
                        <div class="step-number">8</div>
                        <div class="step-content">
                            <div class="step-title">Video Evidence Available</div>
                            <div class="step-desc">If event has video_clip_url, user can click to view synchronized footage from VMS integration</div>
                        </div>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 40px; padding: 30px; background: rgba(102, 126, 234, 0.2); border-radius: 16px; max-width: 600px; margin-left: auto; margin-right: auto;">
                <div style="font-size: 3rem; margin-bottom: 10px;">‚ö°</div>
                <div style="font-size: 1.2rem; font-weight: 600;">End-to-End Latency</div>
                <div style="color: #a0aec0; margin-top: 10px;">Badge swipe to dashboard display: <strong style="color: #68d391;">&lt; 5 seconds</strong></div>
            </div>
        </div>

        <footer>
            <p>ClearView Intelligence - Physical Identity & Access Management Dashboard</p>
            <p style="margin-top: 10px;">Built with Next.js, React, ClickHouse, Mapbox GL</p>
        </footer>
    </div>

    <script>
        function showSlide(index) {
            // Hide all slides
            document.querySelectorAll('.slide').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));

            // Show selected slide
            document.getElementById('slide-' + index).classList.add('active');
            document.querySelectorAll('.nav-tab')[index].classList.add('active');
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            const current = [...document.querySelectorAll('.nav-tab')].findIndex(t => t.classList.contains('active'));
            if (e.key === 'ArrowRight' && current < 5) showSlide(current + 1);
            if (e.key === 'ArrowLeft' && current > 0) showSlide(current - 1);
        });
    </script>
</body>
</html>
